<!DOCTYPE html>
<html>
<head>
    <title>AI Weather Forecast Dashboard</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background: #0b1020;
        }

        #map {
            height: 100vh;
            width: 100vw;
        }

        .info-text {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 22px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            z-index: 1000;
        }

        .model-panel {
            position: absolute;
            top: 80px;
            left: 20px;
            z-index: 1000;
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(14px);
            border-radius: 14px;
            padding: 10px;
            width: 180px;
        }

        .model-panel button {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .model-panel button.active {
            background: linear-gradient(135deg, #00c6ff, #0072ff);
        }
    </style>
</head>

<body>

<div class="info-text">Click on the map to view rainfall forecast</div>

<div class="model-panel">
    <button class="active" onclick="setModel(this,'Pangu-Weather')">‚ö° Pangu</button>
    <button onclick="setModel(this,'FourCastNet')">üåßÔ∏è FourCast</button>
    <button onclick="setModel(this,'GraphCast')">üåä GraphCast</button>
</div>

<div id="map"></div>

<script>
/* ================= ORIGINAL LOGIC ================= */

let currentModel = "Pangu-Weather";
let activeChart = null;
let cachedData = null;

const map = L.map("map").setView([22, 78], 5);

L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
    { maxZoom: 18 }
).addTo(map);

L.tileLayer(
    "https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",
    { maxZoom: 18 }
).addTo(map);

function setModel(btn, model) {
    currentModel = model;
    document.querySelectorAll(".model-panel button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}

/* ================= WIND FLOW ANIMATION (BIGGER ARROWS) ================= */

map.createPane("windPane");
map.getPane("windPane").style.zIndex = 300;

const canvas = document.createElement("canvas");
canvas.style.position = "absolute";
canvas.style.top = 0;
canvas.style.left = 0;
canvas.style.pointerEvents = "none";
map.getPane("windPane").appendChild(canvas);

const ctx = canvas.getContext("2d");

function resize() {
    const s = map.getSize();
    canvas.width = s.x;
    canvas.height = s.y;
}
resize();
map.on("resize move zoom", resize);

const PARTICLES = 800;
let particles = [];

function initWind() {
    particles = [];
    for (let i = 0; i < PARTICLES; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: 0,
            vy: 0,
            life: Math.random() * 200
        });
    }
}
initWind();

function windField(x, y) {
    const angle =
        Math.sin(y * 0.002) * Math.PI +
        Math.cos(x * 0.002) * Math.PI * 0.5;

    return {
        x: Math.cos(angle) * 0.8,
        y: Math.sin(angle) * 0.8
    };
}

function animateWind() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "rgba(0,255,255,0.75)";
    ctx.lineWidth = 1.8;              // üîπ THICKER
    ctx.shadowBlur = 14;              // üîπ STRONGER GLOW
    ctx.shadowColor = "rgba(0,255,255,0.9)";

    particles.forEach(p => {
        const w = windField(p.x, p.y);

        p.vx += w.x * 0.06;
        p.vy += w.y * 0.06;

        const px = p.x;
        const py = p.y;

        // üîπ LONGER STROKE
        p.x += p.vx * 2.2;
        p.y += p.vy * 2.2;
        p.life--;

        ctx.beginPath();
        ctx.moveTo(px, py);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();

        if (
            p.x < 0 || p.y < 0 ||
            p.x > canvas.width || p.y > canvas.height ||
            p.life <= 0
        ) {
            p.x = Math.random() * canvas.width;
            p.y = Math.random() * canvas.height;
            p.vx = p.vy = 0;
            p.life = 200 + Math.random() * 100;
        }
    });

    requestAnimationFrame(animateWind);
}

animateWind();
</script>

</body>
</html>
